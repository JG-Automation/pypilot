<!DOCTYPE HTML>
<html>
<head>
  <title>tinypilot wifi setup</title>
    <script type="text/javascript" src="static/jquery.min.js"></script>
</head>
<body>
  <p>Tinypilot {{_('Wireless Configuration')}}
    <form action="{{ url_for('wifi') }}" method="post">
      <select name="mode" onchange="wifi_mode()">
        <option value="Master">Master (AP)</option>
        <option value="Managed" {{ mode_managed_selected }}>Managed (client)</option>
      </select>
      <p>SSID
        <input type="text" name="ssid">
      <p>{{_('Key (leave blank for no encryption)')}}
        <input type="text" name="key">
      <p>{{_('Client Mode Address (leave blank for dhcp)')}}
        <input type="text" name="address">
      <p>
        <input type="submit" value="Submit">

      <p>{{_('If there is a problem, edit the file')}} /.pypilot/networking.txt
    </form>
  <table id="leases">
		<tr>
			<th>IP Address</th><th>Mac Address</th><th>Name</th><th>Static IP?</th><th>Lease ends on</th>
		</tr>
	</table>
	<script>
		$SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
		$(function() {
			$.getJSON($SCRIPT_ROOT + '/leases',
			function(data) {
				$('#leases').append(
					$.map(data.leases, function(ignore, index) {
						return '<tr>' +
							'<td>' + data.leases[index].ipAddress + '</td>' +
							'<td>' + data.leases[index].macAddress + '</td>' +
							'<td>' + data.leases[index].name + '</td>' +
							'<td>' + ( (data.leases[index].staticIP) ? 'Yes' : 'No' ) + '</td>' +
							'<td>' + ( (data.leases[index].staticIP) ? 'Never' : data.leases[index].leasetime ) + '</td>' +
							'</tr>';
						}).join());
			});

			return false;
		});
	</script>
    <a href="/">Back</a>

  <script>
    wifi = {{ wifi }};
    function wifi_mode() {
      if(document.getElementsByName('mode')[0].value == "Master") {
        ssid = wifi['ssid'];
        key = wifi['key'];
        address = ''
      } else {
        ssid = wifi['client_ssid'];
        key = wifi['client_key'];
        address = wifi['client_address'];
      }

      document.getElementsByName('ssid')[0].value = ssid;
      document.getElementsByName('key')[0].value = key;
      document.getElementsByName('address')[0].value = address;
    }

    document.getElementsByName('mode')[0].value = wifi['mode'];
    wifi_mode();
  </script>
</body>
</html>